<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>ê²Œì‹œê¸€ ìƒì„¸ í˜ì´ì§€</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<style>
    .post-image {
        width: 50%;
        height: 50%;
        object-fit: cover;
    }
</style>
<body>

<h1 th:text="${post.title}">ì œëª©ì…ë‹ˆë‹¤.</h1>
<p th:text="${post.content}">ë‚´ìš©ì´ ë“¤ì–´ê°ˆ ë¶€ë¶„ì…ë‹ˆë‹¤.</p>
<div th:each="filePath : ${post.filepath}">
    <img th:src="@{${filePath}}" class="post-image" alt="ê²Œì‹œê¸€ ì´ë¯¸ì§€" />
</div>
<a th:href="@{/post/delete(id=${post.id})}">ê¸€ ì‚­ì œ</a>
<a th:href="@{/post/modify/{id}(id=${post.id})}">ìˆ˜ì •</a>

<button id="heart-button" th:text="${isHearted != null and isHearted ? 'â¤ï¸' : 'ğŸ¤'}"></button>
<span id="heart-count" th:text="${post.heartCount}">0</span>

<script th:inline="javascript">
    $(document).ready(function () {
        const memberId = 1;  // ì„ì‹œ íšŒì› ID
        const postId = /*[[${post.id}]]*/ 1;

        // ì¢‹ì•„ìš” ì—¬ë¶€ í™•ì¸ í›„ ì•„ì´ì½˜ ë³€ê²½
        $.get(`/like/${memberId}/${postId}`, function (isLiked) {
            if (isLiked) {
                $("#heart-button").text("â¤ï¸");
            } else {
                $("#heart-button").text("ğŸ¤");
            }
        });

        // ì¢‹ì•„ìš” ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
        $("#heart-button").click(function () {
            if ($("#heart-button").text() === "ğŸ¤") {
                $.post(`/heart/${memberId}/${postId}`, function () {
                    $("#heart-button").text("â¤ï¸");
                    let count = parseInt($("#heart-count").text()) + 1;
                    $("#heart-count").text(count);
                }).fail(function () {
                    console.log("ì¢‹ì•„ìš” ì‹¤íŒ¨");
                });
            } else {
                $.ajax({
                    type: "DELETE",
                    url: `/heart/${memberId}/${postId}`,
                    success: function () {
                        $("#heart-button").text("ğŸ¤");
                        let count = Math.max(0, parseInt($("#heart-count").text()) - 1);
                        $("#heart-count").text(count);
                    },
                    error: function () {
                        console.log("ì¢‹ì•„ìš” ì·¨ì†Œ ì‹¤íŒ¨");
                    }
                });
            }
        });
    });
</script>
</body>
</html>
